<!DOCTYPE html>
<html>
  <head>
    <title>Coworker</title>
    <link rel="stylesheet" href="./index.css" />
  </head>
  <body>
    <div id="app" class="container">
      <header>
        <h1>Coworker</h1>
        <div>
          <button
            id="settings-button"
            @click="restartSession"
            title="Restart Session"
          >
            &#x21bb;
          </button>
          <button
            id="settings-button"
            @click="showSettings = true"
            title="Settings"
          >
            &#9881;
          </button>
        </div>
      </header>
      <div id="chat-container" ref="chatContainer">
        <template v-for="(message, index) in chatHistory" :key="index">
          <div
            v-if="message.role === 'user' || (message.role === 'assistant' && message.content)"
            class="message"
            :class="message.role + '-message'"
          >
            <div class="message-bubble" v-html="message.content"></div>
          </div>
          <div
            v-if="message.role === 'assistant' && message.tool_calls"
            v-for="toolCall in message.tool_calls"
            class="message assistant-message tool-message"
          >
            <div
              class="message-bubble"
              :title="'Arguments: ' + toolCall.function.arguments"
            >
              &#x1F527; Calling
              <span class="tool-name">{{ toolCall.function.name }}</span>
            </div>
          </div>
          <div
            v-if="message.role === 'tool'"
            class="message assistant-message tool-message"
          >
            <div class="message-bubble" :title="'Result: ' + message.content">
              &#x26A1; Tool result:
              <span class="tool-name">{{ message.name }}</span>
            </div>
          </div>
        </template>
        <div v-if="isTyping" class="message assistant-message">
          <div
            class="message-bubble"
            style="padding-left: 20px; padding-right: 20px"
          >
            <div class="dot-flashing"></div>
          </div>
        </div>
      </div>
      <div id="input-container">
        <textarea
          id="message-input"
          v-model="newMessage"
          @input="adjustTextareaHeight"
          @keydown.enter.prevent.exact="sendMessage"
          placeholder="Type a message..."
          rows="1"
        ></textarea>
        <button id="send-button" @click="sendMessage">&#10148;</button>
      </div>

      <div
        v-show="showSettings"
        id="settings-modal"
        class="modal"
        style="display: none"
        @click.self="showSettings = false"
      >
        <div class="modal-content">
          <span class="close-button" @click="showSettings = false"
            >&times;</span
          >
          <h2>Settings</h2>
          <label for="apiKey">OpenRouter API Key:</label>
          <input type="password" v-model="apiKey" style="width: 100%" />
          <label for="modelName">Model Name:</label>
          <input type="text" v-model="modelName" style="width: 100%" />
        </div>
      </div>
    </div>

    <script src="./node_modules/vue/dist/vue.global.js"></script>
    <script src="./renderer.js"></script>
  </body>
</html>
